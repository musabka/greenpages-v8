# ๐ ูุธุงู ุงููุญุงุณุจุฉ ุงููุฑูุฒู - Green Core Accounting

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุงููุญุงุณุจุฉ ูู "ุงูููุงุฉ ุงูุฎุถุฑุงุก" ูู **ุงููุญุฑู ุงููุงูู ุงููุฑูุฒู ูุงููุญูุฏ** ุงููุณุคูู ุนู:
- โ ุชุณุฌูู ูู ุญุฑูุฉ ูุงููุฉ ุฐุงุช ุฃุซุฑ ูุญุงุณุจู
- โ ุงูููุฏ ุงููุฒุฏูุฌ (Double Entry) ุงูุฅุฌุจุงุฑู
- โ ุฅุฏุงุฑุฉ ุงูุนููุงุช ุงููุชุนุฏุฏุฉ
- โ ูุธุงู ุงูููุงุชูุฑ
- โ ุณุฌูุงุช ุงูุชุฏููู ุงููุงูู

> **ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ:** ุฃู ููุฏ ูุง ููุฑ ุนุจุฑ Accounting ูู ุฎุทุฑ ุนูู ุงููุธุงู ุจุงููุงูู

---

## ๐๏ธ ุงูุจููุฉ

```
apps/api/src/modules/accounting/
โโโ accounting.module.ts       # ุชุณุฌูู ุงูููุฏููู
โโโ accounting.service.ts      # ุงูุฎุฏูุฉ ุงูุฃุณุงุณูุฉ (~1000 ุณุทุฑ)
โโโ accounting-admin.controller.ts # API ููุฅุฏุงุฑุฉ
โโโ dto/
โ   โโโ accounting.dto.ts      # ูุงุฆูุงุช ููู ุงูุจูุงูุงุช
โโโ plan.md                    # ุงูููุงุตูุงุช ุงูุฃุตููุฉ
```

---

## ๐ ููุงุฐุฌ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุนููุงุช (AccCurrency)
| ุงูุญูู | ุงููุตู |
|-------|-------|
| code | ุฑูุฒ ุงูุนููุฉ (ูุซู SYP, USD) |
| nameAr, nameEn | ุงูุงุณู ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ |
| symbol | ุงูุฑูุฒ (ู.ุณ, $) |
| isBase | ูู ูู ุงูุนููุฉ ุงูุฃุณุงุณูุฉ |
| decimalPlaces | ุนุฏุฏ ุงูุฎุงูุงุช ุงูุนุดุฑูุฉ |

### ุดุฌุฑุฉ ุงูุญุณุงุจุงุช (AccAccount)
| ุงูุญูู | ุงููุตู |
|-------|-------|
| code | ุฑูุฒ ุงูุญุณุงุจ ุงููุฑูุฏ (ูุซู 1100, 4100) |
| accountType | ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE |
| normalBalance | DEBIT ุฃู CREDIT |
| isPosting | ูุงุจู ููุชุฑุญูู ุงููุจุงุดุฑ |
| isSystemAccount | ุญุณุงุจ ูุธุงู |

### ุงููููุฏ ุงููุญุงุณุจูุฉ (AccJournalEntry)
| ุงูุญูู | ุงููุตู |
|-------|-------|
| entryNumber | ุฑูู ุงูููุฏ ุงูุชุณูุณูู |
| status | DRAFT, POSTED, VOID |
| sourceModule | WALLET, COMMISSIONS, INVOICING, MANUAL... |
| sourceEventId | ูุนุฑู ูุฑูุฏ ููุญุฏุซ (ููู idempotency) |

### ุฃุณุทุฑ ุงูููุฏ (AccJournalLine)
| ุงูุญูู | ุงููุตู |
|-------|-------|
| accountId | ุงูุญุณุงุจ |
| debit | ุงููุจูุบ ุงููุฏูู |
| credit | ุงููุจูุบ ุงูุฏุงุฆู |

### ุงูููุงุชูุฑ (AccInvoice)
| ุงูุญูู | ุงููุตู |
|-------|-------|
| invoiceNumber | ุฑูู ุงููุงุชูุฑุฉ ุงูุชุณูุณูู |
| status | DRAFT, ISSUED, PAID, PARTIAL, CANCELLED |
| subtotal, taxTotal, total | ุงููุจุงูุบ |

---

## ๐ง API Endpoints

### ุงูุตุญุฉ ูุงูุฅุญุตุงุฆูุงุช
```
GET  /admin/accounting/health      # ูุญุต ุตุญุฉ ุงูููุฏููู
GET  /admin/accounting/stats       # ุฅุญุตุงุฆูุงุช ุนุงูุฉ
```

### ุงูุนููุงุช
```
GET  /admin/accounting/currencies       # ูุงุฆูุฉ ุงูุนููุงุช
POST /admin/accounting/currencies       # ุฅุถุงูุฉ ุนููุฉ
POST /admin/accounting/currencies/seed  # ุฅูุดุงุก ุงูุนููุงุช ุงูุฃุณุงุณูุฉ
```

### ุดุฌุฑุฉ ุงูุญุณุงุจุงุช
```
GET  /admin/accounting/accounts       # ุฌููุน ุงูุญุณุงุจุงุช
POST /admin/accounting/accounts       # ุฅุถุงูุฉ ุญุณุงุจ
POST /admin/accounting/accounts/seed  # ุฅูุดุงุก ุงูุญุณุงุจุงุช ุงูุฃุณุงุณูุฉ
```

### ุงููุชุฑุงุช ุงููุญุงุณุจูุฉ
```
GET   /admin/accounting/periods           # ุงููุชุฑุงุช
GET   /admin/accounting/periods/current   # ุงููุชุฑุฉ ุงูุญุงููุฉ
PATCH /admin/accounting/periods/:id/close # ุฅุบูุงู ูุชุฑุฉ
```

### ุงููููุฏ ุงููุญุงุณุจูุฉ
```
GET   /admin/accounting/journal-entries        # ูุงุฆูุฉ ุงููููุฏ
GET   /admin/accounting/journal-entries/:id    # ุชูุงุตูู ููุฏ
POST  /admin/accounting/journal-entries/manual # ุฅูุดุงุก ููุฏ ูุฏูู
PATCH /admin/accounting/journal-entries/:id/post # ุชุฑุญูู ููุฏ
PATCH /admin/accounting/journal-entries/:id/void # ุฅูุบุงุก ููุฏ
```

### ุงูููุงุชูุฑ
```
GET   /admin/accounting/invoices      # ูุงุฆูุฉ ุงูููุงุชูุฑ
GET   /admin/accounting/invoices/:id  # ุชูุงุตูู ูุงุชูุฑุฉ
PATCH /admin/accounting/invoices/:id/issue # ุฅุตุฏุงุฑ ูุงุชูุฑุฉ
```

### ุงูุชูุงุฑูุฑ
```
GET /admin/accounting/reports/trial-balance          # ููุฒุงู ุงููุฑุงุฌุนุฉ
GET /admin/accounting/reports/ledger/:accountCode    # ุฏูุชุฑ ุงูุฃุณุชุงุฐ
```

### ุณุฌูุงุช ุงูุชุฏููู
```
GET /admin/accounting/audit-logs  # ุณุฌูุงุช ุงูุชุฏููู
```

---

## ๐ ุงูุชูุงูู ูุน ุงูููุฏูููุงุช ุงูุฃุฎุฑู

### ุงููุญูุธุฉ (Wallet)
ุนูุฏ ุงูููุงููุฉ ุนูู ุทูุจ ุดุญู (`approveTopUp`):
```
ุงูููุฏ:
  ูุฏูู: CASH_CLEARING ุฃู BANK_CLEARING
  ุฏุงุฆู: WALLET_LIABILITY
```

ุนูุฏ ุงูุฏูุน ูู ุงููุญูุธุฉ (`processPayment`):
```
ุงูููุฏ:
  ูุฏูู: WALLET_LIABILITY
  ุฏุงุฆู: SUBSCRIPTION_REVENUE (ุฃู ุญุณุจ ุงูููุน)
  ุฏุงุฆู: PLATFORM_TAX_PAYABLE (ุฅู ูุฌุฏุช ุถุฑูุจุฉ)
```

### ุงูุนูููุงุช (Commissions)
ุนูุฏ ุฅูุดุงุก ุนูููุฉ ููุฏูุจ:
```
ุงูููุฏ:
  ูุฏูู: COMMISSIONS_EXPENSE
  ุฏุงุฆู: AGENT_PAYABLE
```

---

## ๐ ุดุฌุฑุฉ ุงูุญุณุงุจุงุช ุงูุฃุณุงุณูุฉ

### ุงูุฃุตูู (1xxx)
| ุงูููุฏ | ุงูุงุณู |
|-------|-------|
| 1000 | ุงูุฃุตูู |
| 1100 | ุงูููุฏูุฉ ูุงูุจููู |
| 1101 | ุงูุตูุฏูู |
| 1102 | ุงูุจูู ุงูุฑุฆูุณู |
| 1103 | ุจูุงุจุงุช ุงูุฏูุน ุงูุฅููุชุฑููู |
| 1200 | ุงูุฐูู |
| 1201 | ุฐูู ุงูุนููุงุก |

### ุงูุงูุชุฒุงูุงุช (2xxx)
| ุงูููุฏ | ุงูุงุณู |
|-------|-------|
| 2000 | ุงูุงูุชุฒุงูุงุช |
| 2100 | ุฃุฑุตุฏุฉ ุงููุญุงูุธ |
| 2101 | ุฃุฑุตุฏุฉ ูุญุงูุธ ุงููุณุชุฎุฏููู |
| 2200 | ูุณุชุญูุงุช ุงูููุฏูุจูู |
| 2201 | ุนูููุงุช ูุณุชุญูุฉ ููููุฏูุจูู |
| 2300 | ุงูุถุฑุงุฆุจ ุงููุณุชุญูุฉ |
| 2301 | ุถุฑูุจุฉ ุงูููุตุฉ |
| 2302 | ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ |

### ุญููู ุงูููููุฉ (3xxx)
| ุงูููุฏ | ุงูุงุณู |
|-------|-------|
| 3000 | ุญููู ุงูููููุฉ |
| 3100 | ุฑุฃุณ ุงููุงู |
| 3200 | ุงูุฃุฑุจุงุญ ุงููุญุชุฌุฒุฉ |

### ุงูุฅูุฑุงุฏุงุช (4xxx)
| ุงูููุฏ | ุงูุงุณู |
|-------|-------|
| 4000 | ุงูุฅูุฑุงุฏุงุช |
| 4100 | ุฅูุฑุงุฏุงุช ุงูุงุดุชุฑุงูุงุช |
| 4200 | ุฅูุฑุงุฏุงุช ุงูุฅุนูุงูุงุช |
| 4300 | ุฅูุฑุงุฏุงุช ุงูุฎุฏูุงุช |
| 4400 | ุฅูุฑุงุฏุงุช ุฑุณูู ุงูุดุญู |

### ุงููุตุฑููุงุช (5xxx)
| ุงูููุฏ | ุงูุงุณู |
|-------|-------|
| 5000 | ุงููุตุฑููุงุช |
| 5100 | ูุตุฑููุงุช ุงูุนูููุงุช |
| 5200 | ุฑุณูู ุจูุงุจุงุช ุงูุฏูุน |
| 5300 | ูุตุฑููุงุช ุชุดุบูููุฉ |

---

## ๐ ุงูุจุฏุก ุงูุณุฑูุน

### 1. ุชููุฆุฉ ุงูุนููุงุช ูุงูุญุณุงุจุงุช
```bash
# ูู ุฎูุงู API ุฃู Swagger

# ุฅูุดุงุก ุงูุนููุงุช ุงูุฃุณุงุณูุฉ
POST /admin/accounting/currencies/seed

# ุฅูุดุงุก ุดุฌุฑุฉ ุงูุญุณุงุจุงุช
POST /admin/accounting/accounts/seed
```

### 2. ูุญุต ุตุญุฉ ุงููุธุงู
```bash
GET /admin/accounting/health
# ูุฌุจ ุฃู ูุฑุฏ: { ok: true, accounts: X, journalEntries: Y, currencies: Z }
```

### 3. ุนุฑุถ ููุฒุงู ุงููุฑุงุฌุนุฉ
```bash
GET /admin/accounting/reports/trial-balance
```

---

## โ ุงููุจุงุฏุฆ ุงูุฃุณุงุณูุฉ

1. **ุงูุญูููุฉ ุงููุงููุฉ ุงููุงุญุฏุฉ (SSOT)**
   - ูุง ุฃุฑุตุฏุฉ ููุง ุฃุฑุจุงุญ ูุญุณูุจุฉ ุฎุงุฑุฌ ูุฐุง ุงูููุฏููู

2. **ุงูููุฏ ุงููุฒุฏูุฌ ุงูุฅุฌุจุงุฑู**
   - ูู ุนูููุฉ = Journal Entry ูุชูุงุฒู
   - Debit = Credit ุฏุงุฆููุง

3. **ุนุฏู ุงููุงุจููุฉ ููุชูุงุนุจ**
   - ูุง ุญุฐู ูููุฏ
   - ูุง ุชุนุฏูู ูููุฏ POSTED
   - ุงูุชุตุญูุญ ุจูููุฏ ุฌุฏูุฏุฉ ููุท

4. **ุงููุงุจููุฉ ููุชุฏููู**
   - ูู ุฑูู ูุงุจู ููุชุชุจุน
   - ูู ููุฏ ูุฑุชุจุท ุจุญุฏุซ ููุณุชุฎุฏู ููุชุฑุฉ

5. **Idempotency**
   - sourceEventId ูุฑูุฏ ูููุน ุชูุฑุงุฑ ุงููููุฏ

---

## ๐ ููุงุญุธุงุช ูููุทูุฑูู

- ุงุณุชุฎุฏู `WalletAccountingBridge` ููุฑุจุท ุจูู ุงููุญูุธุฉ ูุงููุญุงุณุจุฉ
- ุนูุฏ ุฅุถุงูุฉ ููุฏููู ุฌุฏูุฏุ ุฃูุดุฆ Bridge ููุงุซู
- ุชุฃูุฏ ุฏุงุฆูุงู ูู ุชูุงุฒู ุงูููุฏ ูุจู ุงูุญูุธ
- ุงุณุชุฎุฏู `sourceEventId` ูุฑูุฏ ููู ุนูููุฉ

---

## ๐ฎ ุงูุชุทููุฑ ุงููุณุชูุจูู

- [ ] ุฏูุฑ ุงููุญุงุณุจ ูุน ุตูุงุญูุงุช ูุญุฏูุฏุฉ
- [ ] ุชูุงุฑูุฑ ูุงููุฉ ูุชูุฏูุฉ
- [ ] ุชุตุฏูุฑ ุงูุจูุงูุงุช ุงููุญุงุณุจูุฉ
- [ ] ุงูุชูุงูู ูุน ุฃูุธูุฉ ูุญุงุณุจูุฉ ุฎุงุฑุฌูุฉ
