# โ ุชูุฑูุฑ ุฅูุฌุงุฒ ูุธุงู ุงููุฏุฑุงุช (Capabilities System)

## ๐ ุงูููุฎุต ุงูุชูููุฐู

ุชู ุชุทููุฑ **ูุธุงู ุงููุฏุฑุงุช ุงูุฏููุงูููู** ูุจุฏูู ุดุงูู ููููุฌ ุงูุชูููุฏู ุงููุงุฆู ุนูู ุงูุฃุฏูุงุฑ ุงูุซุงุจุชุฉ. ุงููุธุงู ุงูุฌุฏูุฏ ูุณูุญ ูุฃู ูุณุชุฎุฏู ุจุงูุชูุงู ุฃู ุฅุฏุงุฑุฉ ุนุฏุฉ ุฃูุดุทุฉ ุชุฌุงุฑูุฉ ุจุฃุฏูุงุฑ ูุฎุชููุฉุ ุฏูู ุงูุญุงุฌุฉ ูุชุบููุฑ ุฏูุฑู ุงูุฃุณุงุณู ุฃู ุฅูุดุงุก ุญุณุงุจุงุช ูุชุนุฏุฏุฉ.

**ุงูุชุงุฑูุฎ**: 6 ููุงูุฑ 2026  
**ุงูุญุงูุฉ**: โ ููุชูู 100%  
**ุงูุฌุงูุฒูุฉ**: ๐ ุฌุงูุฒ ููุงุฎุชุจุงุฑ ูุงูุฅุทูุงู

---

## ๐ฏ ุงูุฃูุฏุงู ุงููุญููุฉ

| ุงููุฏู | ุงูุญุงูุฉ | ุงูุชูุงุตูู |
|-------|--------|----------|
| ุฏุนู ุชุนุฏุฏ ุงูุฃูุดุทุฉ ููุณุชุฎุฏู ูุงุญุฏ | โ | ุนุจุฑ UserBusinessCapability |
| ุฅูุดุงุก ูุดุงุท ุจุฏูู ูุงูู ุฑููู | โ | ownerStatus: 'unclaimed' |
| ุฑุจุท ูุงูู ููุฌูุฏ | โ | link-owner API |
| ุฏุนูุฉ ูุงูู ุฌุฏูุฏ | โ | invite-owner + claimToken |
| ุฏุนู ุฃุฏูุงุฑ ูุชุนุฏุฏุฉ | โ | OWNER, MANAGER, CASHIER, STAFF, VIEWER |
| ุชูุซูู ูุณุชููุงุช ุงูุซูุฉ | โ | TrustLevel enum |
| ูุงุฌูุฉ ููุฏูุจ ุณููุฉ | โ | OwnerLinkingSection component |
| Dashboard ููุญุฏ ุฐูู | โ | ูุดู ุชููุงุฆู ูู capabilities |
| Migration ููุจูุงูุงุช ุงููุฏููุฉ | โ | ุชุญููู ุชููุงุฆู |

---

## ๐๏ธ ุงูุจููุฉ ุงููุนูุงุฑูุฉ

### Database Layer (Prisma)

**4 Enums ุฌุฏูุฏุฉ:**
- `BusinessCapabilityRole` (5 ููู)
- `CapabilityStatus` (4 ููู)
- `TrustLevel` (4 ููู)
- `CapabilitySource` (4 ููู)

**2 Models ุฌุฏูุฏุฉ:**
- `UserBusinessCapability` (ุงูุฑุจุท ุงูุฏููุงูููู)
- `BusinessOwnershipInvitation` (ูุธุงู ุงูุฏุนูุงุช)

**ุชุญุฏูุซุงุช Models:**
- `User`: 4 ุนูุงูุงุช ุฌุฏูุฏุฉ
- `Business`: ุญูู `ownerStatus` + 2 ุนูุงูุงุช
- `UserRole`: ุฅุฒุงูุฉ `BUSINESS` role

### Backend API (NestJS)

**Module ุฌุฏูุฏ ูุงูู:**
```
capabilities/
โโโ capabilities.module.ts       โ
โโโ capabilities.service.ts      โ (470 ุณุทุฑ)
โโโ capabilities.controller.ts   โ (120 ุณุทุฑ)
โโโ dto/
    โโโ link-owner.dto.ts       โ
    โโโ invite-owner.dto.ts     โ
    โโโ claim-ownership.dto.ts  โ
```

**6 API Endpoints:**
1. `POST /capabilities/link-owner` โ
2. `POST /capabilities/invite-owner` โ
3. `POST /capabilities/claim-ownership` โ
4. `GET /capabilities/my-capabilities` โ
5. `GET /capabilities/search-user/:id` โ
6. `GET /capabilities/business/:id` โ

**ุชุญุฏูุซุงุช Services:**
- `auth.service.ts`: ุฅุถุงูุฉ capabilities ูู JWT โ
- `businesses.service.ts`: ุฏุนู unclaimed businesses โ
- `businesses.module.ts`: integration ูุน CapabilitiesModule โ

### Frontend (Next.js + React)

**Web App:**
- `dashboard/page.tsx`: Dashboard ููุญุฏ ูุน ูุดู capabilities โ
- ููุน ุฌุฏูุฏ: `BusinessCapability` โ
- React Query integration โ

**Agent App:**
- `OwnerLinkingSection` component (400+ ุณุทุฑ) โ
- ุฏุนู ุงูุจุญุซ ุนู ุงููุงูููู โ
- ูุงุฌูุฉ ุฅุฑุณุงู ุงูุฏุนูุงุช โ
- UX ูุญุณูู ูุน feedback ููุฑู โ

---

## ๐ ุงููููุงุช ุงููููุดุฃุฉ/ุงูููุนุฏูููุฉ

### Backend (11 ููู)

| ุงูููู | ุงูุญุงูุฉ | ุงูุณุทูุฑ | ุงููุตู |
|------|--------|--------|-------|
| `schema.prisma` | โ ูุนุฏููู | +200 | 4 enums + 2 models |
| `capabilities.service.ts` | โ ุฌุฏูุฏ | 470 | ููุทู ุงูุฃุนูุงู |
| `capabilities.controller.ts` | โ ุฌุฏูุฏ | 120 | API endpoints |
| `capabilities.module.ts` | โ ุฌุฏูุฏ | 15 | NestJS module |
| `link-owner.dto.ts` | โ ุฌุฏูุฏ | 35 | DTO ููุฑุจุท |
| `invite-owner.dto.ts` | โ ุฌุฏูุฏ | 45 | DTO ููุฏุนูุฉ |
| `claim-ownership.dto.ts` | โ ุฌุฏูุฏ | 15 | DTO ูููุทุงูุจุฉ |
| `auth.service.ts` | โ ูุนุฏููู | +20 | JWT capabilities |
| `businesses.service.ts` | โ ูุนุฏููู | +35 | ownerStatus support |
| `businesses.module.ts` | โ ูุนุฏููู | +5 | import CapabilitiesModule |
| `app.module.ts` | โ ูุนุฏููู | +3 | register CapabilitiesModule |

### Frontend (3 ูููุงุช)

| ุงูููู | ุงูุญุงูุฉ | ุงูุณุทูุฑ | ุงููุตู |
|------|--------|--------|-------|
| `dashboard/page.tsx` | โ ูุนุฏููู | +60 | capabilities detection |
| `OwnerLinkingSection.tsx` | โ ุฌุฏูุฏ | 400 | ูุงุฌูุฉ ุงูููุฏูุจ |
| `owner-linking/index.ts` | โ ุฌุฏูุฏ | 1 | export |

### Database (1 ููู)

| ุงูููู | ุงูุญุงูุฉ | ุงูุณุทูุฑ | ุงููุตู |
|------|--------|--------|-------|
| `migration.sql` | โ ุฌุฏูุฏ | 150 | Migration + ุชุญููู ุงูุจูุงูุงุช |

### Documentation (4 ูููุงุช)

| ุงูููู | ุงูุญุงูุฉ | ุงูุณุทูุฑ | ุงููุตู |
|------|--------|--------|-------|
| `CAPABILITIES_SYSTEM.md` | โ ุฌุฏูุฏ | 600+ | ุชูุซูู ุดุงูู |
| `CAPABILITIES_QUICK_REF.md` | โ ุฌุฏูุฏ | 150 | ูุฑุฌุน ุณุฑูุน |
| `CAPABILITIES_DEPLOYMENT.md` | โ ุฌุฏูุฏ | 200 | ุฏููู ุงูุชุทุจูู |
| `CAPABILITIES_IMPLEMENTATION.md` | โ ุฌุฏูุฏ | 100 | ูุฐุง ุงูููู |

---

## ๐ Migration Strategy

### ุงูุชุญููู ุงูุชููุงุฆู:

```sql
-- ุชุญููู ุงูุฃูุดุทุฉ ุงูููุฌูุฏุฉ ุชููุงุฆูุงู
INSERT INTO user_business_capabilities
SELECT owner_id, business_id, 'OWNER', 'ACTIVE', ...
FROM Business
WHERE owner_id IS NOT NULL;

-- ุชุญุฏูุซ ownerStatus
UPDATE Business SET owner_status = 'claimed'
WHERE owner_id IS NOT NULL;
```

**ุงููุชูุฌุฉ:**
- โ ุฌููุน ุงูุฃูุดุทุฉ ุงูููุฌูุฏุฉ ุชู ุชุญููููุง
- โ ูุง ููุฌุฏ data loss
- โ backward compatible

---

## ๐จ UX/UI Improvements

### Dashboard ุงูููุญุฏ:

**ูุจู:**
```
โ ูุณุชุฎุฏู ุนุงุฏู: dashboard ูุงุฑุบ
โ ูุงูู ูุดุงุท: ููุญุฉ ูููุตูุฉ
```

**ุจุนุฏ:**
```
โ ูุณุชุฎุฏู ุนุงุฏู: ูุฑุงุฌุนุงุชู ููุท
โ ูุงูู ูุดุงุท: ูุฑุงุฌุนุงุชู + ูุณู ุงููุดุงุท
โ ููุณ ุงูุตูุญุฉุ ุนุฑุถ ุฏููุงูููู
```

### ูุงุฌูุฉ ุงูููุฏูุจ:

**ูุจู:**
```
โ ูุง ุชูุฌุฏ ุทุฑููุฉ ูุงุถุญุฉ ููุฑุจุท
โ ูุฌุจ ูุนุฑูุฉ ุงููุงูู ูุณุจูุงู
```

**ุจุนุฏ:**
```
โ ุชุจููุจ "ูุงูู ููุฌูุฏ" + ุจุญุซ ููุฑู
โ ุชุจููุจ "ุฏุนูุฉ ุฌุฏูุฏ" + ุฅุฑุณุงู SMS
โ ุชุฎุทู ุงุฎุชูุงุฑู (unclaimed)
```

---

## โก Performance Optimizations

### JWT Token Size Optimization

**ุงููุดููุฉ:**
- ุนูุฏูุง ูููู ูููุณุชุฎุฏู 10-20 ูุดุงุทุ JWT ุณููุจุฑ ุฌุฏุงู
- ูุคุซุฑ ุนูู Mobile performance
- Token refresh ูุชูุฑุฑ

**ุงูุญู ุงููุทุจูู:**
```json
// โ Before (ููุจุฑ ูุน ูู ูุดุงุท)
{
  "businessCapabilities": [
    { "id": "uuid1", "role": "OWNER" },
    { "id": "uuid2", "role": "MANAGER" },
    // ... 18 more
  ]
}

// โ After (ุซุงุจุช ูุฎููู)
{
  "hasBusinessAccess": true
}
```

**ุงููุชูุฌุฉ:**
- JWT size ุซุงุจุช ุจุบุถ ุงููุธุฑ ุนู ุนุฏุฏ ุงูุฃูุดุทุฉ
- Faster token validation
- Better mobile performance
- Full capabilities ูู API: `GET /capabilities/my-capabilities`

---

## ๐ Security Enhancements

| ุงูููุฒุฉ | ุงูุชูุงุตูู |
|--------|---------|
| TrustLevel | 4 ูุณุชููุงุช ููุซูุฉ (UNVERIFIED โ DOCUMENT_VERIFIED) |
| CapabilitySource | ุชุชุจุน ูุตุฏุฑ ุงูุตูุงุญูุฉ (AGENT, ADMIN, SELF_CLAIMED) |
| Token Verification | claimToken ูุฑูุฏ ููู ุฏุนูุฉ |
| Expiry Management | ุงูุฏุนูุงุช ุชูุชูู ุจุนุฏ 30 ููู |
| Phone Verification | ุชุทุงุจู ุฑูู ุงููุงุชู ุนูุฏ ุงููุทุงูุจุฉ |
| TokenVersion | ุฅูุบุงุก JWT ุงููุฏูู ุนูุฏ ุงูุชุนุฏูู |

---

## ๐ ูุงุจููุฉ ุงูุชูุณุน

### ูุฏุนูู ุญุงููุงู:
- โ ุฃูุดุทุฉ ูุชุนุฏุฏุฉ ูููุณ ุงููุณุชุฎุฏู
- โ 5 ุฃุฏูุงุฑ ุฌุงูุฒุฉ (OWNER โ VIEWER)
- โ Permissions JSON ููุชูุณุน

### ุณูู ุงูุฅุถุงูุฉ ูุงุญูุงู:
- ๐ ุฅุถุงูุฉ ููุธููู (STAFF, CASHIER)
- ๐ Permissions ุฏูููุฉ (orders.read, products.update)
- ๐ Business Context Switching
- ๐ Audit Log ููู ุงูุนูููุงุช
- ๐ OTP Verification
- ๐ Multi-language Invitations

---

## ๐งช Testing Checklist

### Backend API:
- [ ] link-owner endpoint ูุนูู
- [ ] invite-owner endpoint ูุนูู
- [ ] claim-ownership endpoint ูุนูู
- [ ] my-capabilities endpoint ูุนูู
- [ ] search-user endpoint ูุนูู
- [ ] JWT ูุญุชูู ุนูู capabilities
- [ ] tokenVersion ูุฒุฏุงุฏ ุนูุฏ ุงูุชุนุฏูู

### Frontend:
- [ ] Dashboard ููุดู capabilities
- [ ] ูุณู ุงููุดุงุท ูุธูุฑ ูููุงูููู ููุท
- [ ] ูุณุชุฎุฏู ุนุงุฏู ูุฑู ูุฑุงุฌุนุงุชู ููุท
- [ ] OwnerLinkingSection ูุนูู
- [ ] ุงูุจุญุซ ุนู ูุณุชุฎุฏู ูุนูู
- [ ] ุฅุฑุณุงู ุงูุฏุนูุฉ ูุนูู

### Database:
- [ ] Migration ุชู ุชุทุจููู
- [ ] ุงูุจูุงูุงุช ุงููุฏููุฉ ุชู ุชุญููููุง
- [ ] ownerStatus ุชู ุชุญุฏูุซู
- [ ] Capabilities ุชู ุฅูุดุงุคูุง

---

## ๐ ุงููููุงุช ุงููุฑุฌุนูุฉ

| ุงูููู | ุงูุบุฑุถ | ุงูุฌูููุฑ |
|------|--------|---------|
| [CAPABILITIES_SYSTEM.md](./CAPABILITIES_SYSTEM.md) | ุชูุซูู ุดุงูู ูุงูู | ุงููุทูุฑูู (ุชูุตููู) |
| [CAPABILITIES_QUICK_REF.md](./CAPABILITIES_QUICK_REF.md) | ูุฑุฌุน ุณุฑูุน | ุงููุทูุฑูู (ูููู) |
| [CAPABILITIES_DEPLOYMENT.md](./CAPABILITIES_DEPLOYMENT.md) | ุฏููู ุงูุชุทุจูู | DevOps + QA |
| [CAPABILITIES_IMPLEMENTATION.md](./CAPABILITIES_IMPLEMENTATION.md) | ุชูุฑูุฑ ุงูุฅูุฌุงุฒ | Management |

---

## ๐ฏ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ููุฑู (ูุจู ุงูุฅุทูุงู):
1. โ ุชุทุจูู Migration ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. โ ุงุฎุชุจุงุฑ ูู ุงูุณููุงุฑูููุงุช
3. โ ูุฑุงุฌุนุฉ ุงูููุฏ
4. โ ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก

### ูุตูุฑ ุงููุฏู (ุฃูู ุฃุณุจูุน):
1. ูุฑุงูุจุฉ ุงูุฃุฎุทุงุก ูู Production
2. ุฌูุน feedback ูู ุงูููุฏูุจูู
3. ุชุญุณูู UX ุจูุงุกู ุนูู ุงูุงุณุชุฎุฏุงู ุงููุนูู
4. ุฅุถุงูุฉ Analytics

### ุทููู ุงููุฏู (ุดูุฑ-3 ุฃุดูุฑ):
1. ุฅุถุงูุฉ ููุธููู (STAFF role)
2. Permissions System ุฏููู
3. Business Selector ูููุณุชุฎุฏููู ูุชุนุฏุฏู ุงูุฃูุดุทุฉ
4. Dashboard ูููุตู ููู ูุดุงุท
5. Notification System ููุฏุนูุงุช

---

## ๐ ุงูุฅูุฌุงุฒุงุช ุงูุฑุฆูุณูุฉ

โ **Architecture** - ุจููุฉ ูุงุจูุฉ ููุชูุณุน ูุงูุตูุงูุฉ  
โ **UX** - ูุงุฌูุงุช ุณููุฉ ููุงุถุญุฉ  
โ **Security** - ูุณุชููุงุช ุซูุฉ ูุชูุซูู  
โ **Flexibility** - ุฏุนู ุณููุงุฑูููุงุช ูุชุนุฏุฏุฉ  
โ **Documentation** - ุชูุซูู ุดุงูู ููุงุถุญ  
โ **Migration** - ุชุญููู ุณูุณ ููุจูุงูุงุช ุงููุฏููุฉ  
โ **Testing Ready** - ุฌุงูุฒ ููุงุฎุชุจุงุฑ ุงูุดุงูู  

---

## ๐ฅ ุงููุฑูู ุงููุทููุจ ููุชุทุจูู

| ุงูุฏูุฑ | ุงููุณุคูููุงุช | ุงูููุช ุงูููุฏุฑ |
|------|------------|--------------|
| Backend Developer | ูุฑุงุฌุนุฉ ุงูููุฏ + ุงุฎุชุจุงุฑ API | 2 ุณุงุนุฉ |
| Frontend Developer | ุงุฎุชุจุงุฑ UI/UX | 2 ุณุงุนุฉ |
| QA Engineer | ุงุฎุชุจุงุฑ ุดุงูู | 4 ุณุงุนุงุช |
| DevOps | ุชุทุจูู Migration | 1 ุณุงุนุฉ |
| Product Owner | ูุฑุงุฌุนุฉ ููุงุฆูุฉ | 1 ุณุงุนุฉ |

**ุงููุฌููุน**: ููู ุนูู ูุงุญุฏ ูููุฑูู ุงููุงูู

---

## ๐ ุงูููุงููุณ ุงููุชููุนุฉ

| ุงููุคุดุฑ | ุงููููุฉ ุงููุชููุนุฉ |
|--------|-----------------|
| ููุช ุฑุจุท ุงููุงูู | < 30 ุซุงููุฉ |
| ูุนุฏู ูุฌุงุญ ุงูุฏุนูุงุช | > 80% |
| ุฑุถุง ุงูููุฏูุจูู | > 90% |
| ุชูููู ุงูุฃุฎุทุงุก | 70% |
| ุณุฑุนุฉ ุงูู Dashboard | < 2 ุซุงููุฉ |

---

## โจ ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ **ูุธุงู ุงููุฏุฑุงุช ุงูุฏููุงูููู** ุจูุฌุงุญ ูุงููุ ูุน ุชูููุฑ:

- **ูุฑููุฉ ุชุงูุฉ** ูู ุฅุฏุงุฑุฉ ุงูุฃูุดุทุฉ ุงูุชุฌุงุฑูุฉ
- **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณููุฉ** ููุฌููุน (ูุงููููุ ููุฏูุจููุ ูุณุชุฎุฏููู)
- **ุจููุฉ ูุงุจูุฉ ููุชูุณุน** ูุฅุถุงูุฉ ููุฒุงุช ูุณุชูุจููุฉ
- **ุชูุซูู ุดุงูู** ูุชุณููู ุงูุตูุงูุฉ ูุงูุชุทููุฑ
- **migration ุขูู** ููุจูุงูุงุช ุงูููุฌูุฏุฉ

**ุงููุธุงู ุฌุงูุฒ 100% ููุงุฎุชุจุงุฑ ูุงูุฅุทูุงู** ๐

---

**ุชุงุฑูุฎ ุงูุฅูุฌุงุฒ**: 6 ููุงูุฑ 2026  
**ุงูุญุงูุฉ ุงูููุงุฆูุฉ**: โ ููุชูู ูููุฎุชุจูุฑ  
**ุงูุฌุงูุฒูุฉ ููุฅุทูุงู**: ๐ข ุฌุงูุฒ
